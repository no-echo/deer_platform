<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ”¶è—åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .action-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .action-btn.active {
            background: #28a745;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>æ”¶è—åŠŸèƒ½æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>æ¨¡æ‹Ÿå¸–å­</h2>
        <div id="post-actions">
            <!-- è¿™é‡Œä¼šåŠ¨æ€ç”ŸæˆæŒ‰é’® -->
        </div>
        <div class="status" id="status">
            çŠ¶æ€ï¼šæœªåˆå§‹åŒ–
        </div>
        <button onclick="simulateRefresh()">æ¨¡æ‹Ÿé¡µé¢åˆ·æ–°</button>
        <button onclick="resetTest()">é‡ç½®æµ‹è¯•</button>
    </div>

    <script src="js/api.js"></script>
    <script>
        // æ¨¡æ‹Ÿå¸–å­æ•°æ®
        let currentPost = {
            id: 999,
            title: "æµ‹è¯•å¸–å­",
            likeCount: 5,
            favoriteCount: 3,
            isLiked: false,
            isFavorited: false
        };

        // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®
        let currentUser = {
            id: 1,
            username: "testuser"
        };

        // æ›´æ–°æ“ä½œæŒ‰é’®æ˜¾ç¤º
        function updatePostActions() {
            const actionsElement = document.getElementById('post-actions');
            if (actionsElement) {
                const likeClass = currentPost.isLiked ? 'action-btn active' : 'action-btn';
                const favoriteClass = currentPost.isFavorited ? 'action-btn active' : 'action-btn';
                const likeText = currentPost.isLiked ? 'å·²ç‚¹èµ' : 'ç‚¹èµ';
                const favoriteText = currentPost.isFavorited ? 'å·²æ”¶è—' : 'æ”¶è—';
                
                actionsElement.innerHTML = `
                    <button class="${likeClass}" onclick="toggleLike()">
                        <span>ğŸ‘</span>
                        <span>${likeText} (${currentPost.likeCount || 0})</span>
                    </button>
                    <button class="${favoriteClass}" onclick="toggleFavorite()">
                        <span>â­</span>
                        <span>${favoriteText} (${currentPost.favoriteCount || 0})</span>
                    </button>
                `;
            }
            updateStatus();
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus() {
            const statusElement = document.getElementById('status');
            statusElement.innerHTML = `
                çŠ¶æ€ï¼šç‚¹èµæ•° ${currentPost.likeCount}, æ”¶è—æ•° ${currentPost.favoriteCount}<br>
                ç”¨æˆ·çŠ¶æ€ï¼š${currentPost.isLiked ? 'å·²ç‚¹èµ' : 'æœªç‚¹èµ'}, ${currentPost.isFavorited ? 'å·²æ”¶è—' : 'æœªæ”¶è—'}
            `;
        }

        // æ¨¡æ‹Ÿç‚¹èµåŠŸèƒ½
        function toggleLike() {
            currentPost.isLiked = !currentPost.isLiked;
            currentPost.likeCount += currentPost.isLiked ? 1 : -1;
            updatePostActions();
            console.log('ç‚¹èµçŠ¶æ€åˆ‡æ¢:', currentPost.isLiked, 'ç‚¹èµæ•°:', currentPost.likeCount);
        }

        // æ¨¡æ‹Ÿæ”¶è—åŠŸèƒ½
        function toggleFavorite() {
            currentPost.isFavorited = !currentPost.isFavorited;
            currentPost.favoriteCount += currentPost.isFavorited ? 1 : -1;
            updatePostActions();
            console.log('æ”¶è—çŠ¶æ€åˆ‡æ¢:', currentPost.isFavorited, 'æ”¶è—æ•°:', currentPost.favoriteCount);
        }

        // æ¨¡æ‹Ÿé¡µé¢åˆ·æ–°ï¼ˆé‡æ–°åŠ è½½çŠ¶æ€ï¼‰
        function simulateRefresh() {
            // æ¨¡æ‹Ÿä»æœåŠ¡å™¨è·å–çŠ¶æ€
            const mockStatus = {
                isLiked: currentPost.isLiked,
                isFavorited: currentPost.isFavorited,
                likeCount: currentPost.likeCount,
                favoriteCount: currentPost.favoriteCount
            };
            
            // é‡æ–°è®¾ç½®çŠ¶æ€ï¼ˆæ¨¡æ‹Ÿé¡µé¢åˆ·æ–°åçš„çŠ¶æ€åŠ è½½ï¼‰
            currentPost.isLiked = mockStatus.isLiked;
            currentPost.isFavorited = mockStatus.isFavorited;
            currentPost.likeCount = mockStatus.likeCount || 0;
            currentPost.favoriteCount = mockStatus.favoriteCount || 0;
            
            updatePostActions();
            console.log('æ¨¡æ‹Ÿé¡µé¢åˆ·æ–°å®Œæˆï¼ŒçŠ¶æ€ä¿æŒ:', mockStatus);
        }

        // é‡ç½®æµ‹è¯•
        function resetTest() {
            currentPost = {
                id: 999,
                title: "æµ‹è¯•å¸–å­",
                likeCount: 5,
                favoriteCount: 3,
                isLiked: false,
                isFavorited: false
            };
            updatePostActions();
            console.log('æµ‹è¯•é‡ç½®å®Œæˆ');
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updatePostActions();
            console.log('æµ‹è¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        });
    </script>
</body>
</html>