<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººä¸­å¿ƒ - æ—éºå…»æ®–äº¤æµåˆ†äº«å¹³å°</title>
        <link rel="stylesheet" href="css/user-center.css">
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <a href="index.html" class="logo">æ—éºå…»æ®–å¹³å°</a>
            <div class="user-info">
                <span id="welcome-text">æ¬¢è¿ï¼Œç”¨æˆ·</span>
                <a href="#" id="logout-btn" style="color: white; margin-left: 1rem;">é€€å‡ºç™»å½•</a>
            </div>
        </div>
    </header>

    <div class="main-container">
        <aside class="sidebar">
            <div class="user-profile">
                <div class="user-avatar" id="user-avatar">ç”¨</div>
                <input type="file" id="avatar-upload" accept="image/*" style="display: none;">
                <div class="user-name" id="user-name">ç”¨æˆ·</div>
                <div class="user-title" id="user-title">æ—éºå…»æ®–çˆ±å¥½è€…</div>
                <div class="user-stats">
                    <div class="stat-item">
                        <div class="stat-number" id="posts-count">0</div>
                        <div class="stat-label">å‘å¸ƒ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="collections-count">0</div>
                        <div class="stat-label">æ”¶è—</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="follows-count">0</div>
                        <div class="stat-label">å…³æ³¨</div>
                    </div>
                </div>
            </div>
            
            <nav>
                <ul class="nav-menu">
                    <li><a href="#" class="active" onclick="showContent('profile')">ä¸ªäººèµ„æ–™</a></li>
                    <li><a href="#" onclick="showContent('posts')">æˆ‘çš„å‘å¸ƒ</a></li>
                    <li><a href="#" onclick="showContent('collections')">æˆ‘çš„æ”¶è—</a></li>
                    <li><a href="#" onclick="showContent('vip')">VIPè®¢é˜…</a></li>
                    <li><a href="#" onclick="showContent('settings')">è´¦æˆ·è®¾ç½®</a></li>
                </ul>
            </nav>
        </aside>

        <main class="content-area">
            <!-- ä¸ªäººèµ„æ–™ -->
            <div id="profile-content" class="content-section">
                <div class="content-header">
                    <h2 class="content-title">ä¸ªäººèµ„æ–™</h2>
                </div>
                
                <form id="profile-form">
                    <div class="form-group">
                        <label for="username">ç”¨æˆ·å</label>
                        <input type="text" id="username" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="nickname">æ˜µç§°</label>
                        <input type="text" id="nickname">
                    </div>
                    
                    <div class="form-group">
                        <label for="email">é‚®ç®±</label>
                        <input type="email" id="email">
                    </div>
                    
                    <div class="form-group">
                        <label for="bio">ä¸ªäººç®€ä»‹</label>
                        <textarea id="bio" placeholder="ä»‹ç»ä¸€ä¸‹è‡ªå·±..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="location">æ‰€åœ¨åœ°åŒº</label>
                        <input type="text" id="location">
                    </div>
                    
                    <div class="form-group">
                        <label>å¤´åƒ</label>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div class="avatar-preview" id="avatar-preview" style="width: 60px; height: 60px; border-radius: 50%; background: #007bff; color: white; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer;" onclick="document.getElementById('avatar-upload').click()">ç”¨</div>
                            <button type="button" onclick="document.getElementById('avatar-upload').click()" class="btn" style="background: #6c757d; color: white;">æ›´æ¢å¤´åƒ</button>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">ä¿å­˜ä¿®æ”¹</button>
                </form>
            </div>

            <!-- æˆ‘çš„å‘å¸ƒ -->
            <div id="posts-content" class="content-section" style="display: none;">
                <div class="content-header">
                    <h2 class="content-title">æˆ‘çš„å‘å¸ƒ (<span id="my-posts-count">0</span>)</h2>
                    <a href="create-post.html" class="btn btn-primary">å‘å¸ƒæ–°å¸–</a>
                </div>
                
                <div id="my-posts-list" class="post-list">
                    <!-- åŠ¨æ€åŠ è½½ç”¨æˆ·å‘å¸ƒçš„å¸–å­ -->
                </div>
                
                <div id="my-posts-loading" style="text-align: center; padding: 2rem; display: none;">
                    <p>åŠ è½½ä¸­...</p>
                </div>
                
                <div id="my-posts-empty" style="text-align: center; padding: 2rem; color: #666; display: none;">
                    <p>æ‚¨è¿˜æ²¡æœ‰å‘å¸ƒä»»ä½•å¸–å­</p>
                    <a href="create-post.html" class="btn btn-primary">å‘å¸ƒç¬¬ä¸€ç¯‡å¸–å­</a>
                </div>
            </div>

            <!-- æˆ‘çš„æ”¶è— -->
            <div id="collections-content" class="content-section" style="display: none;">
                <div class="content-header">
                    <h2 class="content-title">æˆ‘çš„æ”¶è— (<span id="my-collections-count">0</span>)</h2>
                </div>
                
                <div id="my-collections-list" class="post-list">
                    <!-- åŠ¨æ€åŠ è½½ç”¨æˆ·æ”¶è—çš„å¸–å­ -->
                </div>
                
                <div id="my-collections-loading" style="text-align: center; padding: 2rem; display: none;">
                    <p>åŠ è½½ä¸­...</p>
                </div>
                
                <div id="my-collections-empty" style="text-align: center; padding: 2rem; color: #666; display: none;">
                    <p>æ‚¨è¿˜æ²¡æœ‰æ”¶è—ä»»ä½•å¸–å­</p>
                    <a href="index.html" class="btn btn-primary">å»é¦–é¡µçœ‹çœ‹</a>
                </div>
            </div>

            <!-- VIPè®¢é˜… -->
            <div id="vip-content" class="content-section" style="display: none;">
                <div class="content-header">
                    <h2 class="content-title">VIPè®¢é˜…</h2>
                </div>
                
                <div class="vip-card">
                    <h3 class="vip-title">ğŸŒŸ å‡çº§VIPä¼šå‘˜</h3>
                    <ul class="vip-benefits">
                        <li>ä¸“å±ä¼˜è´¨å†…å®¹è®¿é—®æƒé™</li>
                        <li>ä¼˜å…ˆå®¢æœæ”¯æŒ</li>
                        <li>çº¿ä¸‹æ´»åŠ¨ä¼˜å…ˆæŠ¥å</li>
                        <li>ä¸“å®¶ä¸€å¯¹ä¸€å’¨è¯¢æœºä¼š</li>
                        <li>æ— å¹¿å‘Šæµè§ˆä½“éªŒ</li>
                    </ul>
                    <div class="vip-price">Â¥200/å¹´</div>
                    <button class="btn btn-vip" onclick="alert('VIPåŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼')">ç«‹å³è®¢é˜…</button>
                </div>
                
                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px;">
                    <h4 id="vip-status">å½“å‰çŠ¶æ€ï¼šæ™®é€šç”¨æˆ·</h4>
                    <p style="color: #666; margin-top: 0.5rem;">å‡çº§VIPäº«å—æ›´å¤šä¸“ä¸šæœåŠ¡å’Œä¼˜è´¨å†…å®¹</p>
                </div>
            </div>

            <!-- è´¦æˆ·è®¾ç½® -->
            <div id="settings-content" class="content-section" style="display: none;">
                <div class="content-header">
                    <h2 class="content-title">è´¦æˆ·è®¾ç½®</h2>
                </div>
                
                <form id="password-form">
                    <div class="form-group">
                        <label for="current-password">å½“å‰å¯†ç </label>
                        <input type="password" id="current-password" placeholder="è¯·è¾“å…¥å½“å‰å¯†ç " required>
                    </div>
                    
                    <div class="form-group">
                        <label for="new-password">æ–°å¯†ç </label>
                        <input type="password" id="new-password" placeholder="è¯·è¾“å…¥æ–°å¯†ç " required minlength="6">
                    </div>
                    
                    <div class="form-group">
                        <label for="confirm-password">ç¡®è®¤æ–°å¯†ç </label>
                        <input type="password" id="confirm-password" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç " required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">ä¿®æ”¹å¯†ç </button>
                </form>
                
                <hr style="margin: 2rem 0;">
                
                <h4 style="color: #dc3545; margin-bottom: 1rem;">å±é™©æ“ä½œ</h4>
                <p style="color: #666; margin-bottom: 1rem;">æ³¨é”€è´¦æˆ·å°†æ°¸ä¹…åˆ é™¤æ‚¨çš„æ‰€æœ‰æ•°æ®ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚</p>
                <button class="btn" style="background-color: #dc3545; color: white;" onclick="confirmDeleteAccount()">æ³¨é”€è´¦æˆ·</button>
            </div>
        </main>
    </div>

    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script>
        let currentUser = null;
        let userPosts = [];
        let userCollections = [];

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            loadUserProfile();
            
            // ç»‘å®šäº‹ä»¶
            document.getElementById('logout-btn').addEventListener('click', logout);
            document.getElementById('profile-form').addEventListener('submit', updateProfile);
            document.getElementById('password-form').addEventListener('submit', changePassword);
            document.getElementById('avatar-upload').addEventListener('change', handleAvatarUpload);
            document.getElementById('user-avatar').addEventListener('click', () => {
                document.getElementById('avatar-upload').click();
            });
        });

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLoginStatus() {
            const token = localStorage.getItem('token');
            const username = localStorage.getItem('username');
            
            if (!token || !username) {
                alert('è¯·å…ˆç™»å½•');
                window.location.href = 'login.html';
                return;
            }
            
            document.getElementById('welcome-text').textContent = `æ¬¢è¿ï¼Œ${username}`;
        }

        // åŠ è½½ç”¨æˆ·èµ„æ–™
        async function loadUserProfile() {
            try {
                const response = await userAPI.getProfile();
                if (response.success) {
                    currentUser = response.data;
                    displayUserProfile(currentUser);
                }
            } catch (error) {
                console.error('è·å–ç”¨æˆ·ä¿¡æ¯å‡ºé”™:', error);
            }
        }

        // æ›´æ–°ä¸ªäººèµ„æ–™
        async function updateProfile(event) {
            event.preventDefault();
            const formData = {
                nickname: document.getElementById('nickname').value,
                email: document.getElementById('email').value,
                bio: document.getElementById('bio').value,
                location: document.getElementById('location').value
            };
            
            const response = await userAPI.updateProfile(formData);
            if (response.success) {
                alert('ä¸ªäººèµ„æ–™æ›´æ–°æˆåŠŸï¼');
                currentUser = { ...currentUser, ...formData };
                displayUserProfile(currentUser);
            } else {
                alert('æ›´æ–°å¤±è´¥ï¼š' + response.message);
            }
        }

        // æ˜¾ç¤ºç”¨æˆ·èµ„æ–™
        function displayUserProfile(user) {
            // æ›´æ–°ä¾§è¾¹æ ç”¨æˆ·ä¿¡æ¯
            document.getElementById('user-name').textContent = user.nickname || user.username;
            document.getElementById('user-title').textContent = user.bio || 'æ—éºå…»æ®–çˆ±å¥½è€…';
            
            // æ›´æ–°å¤´åƒ
            const avatarElement = document.getElementById('user-avatar');
            const avatarPreview = document.getElementById('avatar-preview');
            const avatarUrl = user.avatarUrl || user.avatar;
            
            if (avatarUrl) {
                avatarElement.style.backgroundImage = `url(${avatarUrl})`;
                avatarElement.style.backgroundSize = 'cover';
                avatarElement.style.backgroundPosition = 'center';
                avatarElement.textContent = '';
                
                if (avatarPreview) {
                    avatarPreview.style.backgroundImage = `url(${avatarUrl})`;
                    avatarPreview.style.backgroundSize = 'cover';
                    avatarPreview.style.backgroundPosition = 'center';
                    avatarPreview.textContent = '';
                }
            } else {
                const firstChar = (user.nickname || user.username).charAt(0);
                avatarElement.textContent = firstChar;
                avatarElement.style.backgroundImage = 'none';
                
                if (avatarPreview) {
                    avatarPreview.textContent = firstChar;
                    avatarPreview.style.backgroundImage = 'none';
                }
            }
            
            // æ›´æ–°è¡¨å•æ•°æ®
            document.getElementById('username').value = user.username || '';
            document.getElementById('nickname').value = user.nickname || '';
            document.getElementById('email').value = user.email || '';
            document.getElementById('bio').value = user.bio || '';
            document.getElementById('location').value = user.location || '';
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®ï¼ˆè¿™é‡Œéœ€è¦è°ƒç”¨ç›¸åº”çš„APIè·å–çœŸå®æ•°æ®ï¼‰
            updateUserStats();
        }

        // æ›´æ–°ç”¨æˆ·ç»Ÿè®¡æ•°æ®
        async function updateUserStats() {
            try {
                // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
                if (!currentUser) {
                    console.log('ç”¨æˆ·æœªç™»å½•ï¼Œè·³è¿‡ç»Ÿè®¡æ•°æ®æ›´æ–°');
                    return;
                }
                
                // è·å–ç”¨æˆ·å‘å¸ƒçš„å¸–å­æ•°é‡
                const postsResponse = await postAPI.getMy(0, 1);
                if (postsResponse.success && postsResponse.data) {
                    const total = postsResponse.data.totalElements || 0;
                    document.getElementById('posts-count').textContent = total;
                    document.getElementById('my-posts-count').textContent = total;
                } else {
                    // è®¾ç½®é»˜è®¤å€¼
                    document.getElementById('posts-count').textContent = '0';
                    document.getElementById('my-posts-count').textContent = '0';
                }
                
                // è·å–ç”¨æˆ·æ”¶è—æ•°é‡ï¼ˆè¿™é‡Œå‡è®¾æœ‰ç›¸åº”çš„APIï¼‰
                // const collectionsResponse = await userAPI.getCollections(1, 1);
                // if (collectionsResponse.success) {
                //     document.getElementById('collections-count').textContent = collectionsResponse.data.total || 0;
                //     document.getElementById('my-collections-count').textContent = collectionsResponse.data.total || 0;
                // }
                
                // æš‚æ—¶è®¾ç½®é»˜è®¤å€¼
                document.getElementById('collections-count').textContent = '0';
                document.getElementById('my-collections-count').textContent = '0';
                document.getElementById('follows-count').textContent = '0';
            } catch (error) {
                console.error('è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ®å‡ºé”™:', error);
            }
        }

        // æ›´æ–°ä¸ªäººèµ„æ–™
        async function updateProfile(event) {
            event.preventDefault();
            
            const formData = {
                nickname: document.getElementById('nickname').value,
                email: document.getElementById('email').value,
                bio: document.getElementById('bio').value,
                location: document.getElementById('location').value
            };
            
            try {
                const response = await userAPI.updateProfile(formData);
                if (response.success) {
                    alert('ä¸ªäººèµ„æ–™æ›´æ–°æˆåŠŸï¼');
                    currentUser = { ...currentUser, ...formData };
                    displayUserProfile(currentUser);
                } else {
                    alert('æ›´æ–°å¤±è´¥ï¼š' + response.message);
                }
            } catch (error) {
                console.error('æ›´æ–°ä¸ªäººèµ„æ–™å‡ºé”™:', error);
                alert('æ›´æ–°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // å¤„ç†å¤´åƒä¸Šä¼ 
        async function handleAvatarUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // æ–‡ä»¶éªŒè¯
            if (!file.type.startsWith('image/')) {
                alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶');
                return;
            }
            
            if (file.size > 2 * 1024 * 1024) {
                alert('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡2MB');
                return;
            }
            
            try {
                const response = await fileAPI.uploadAvatar(file);
                if (response.success) {
                    // è·å–ä¸Šä¼ åçš„å¤´åƒURL
                    const avatarUrl = response.data.url;
                    
                    // ä¿å­˜å¤´åƒURLåˆ°ç”¨æˆ·èµ„æ–™
                    const updateResponse = await userAPI.updateProfile({
                        ...currentUser,
                        avatarUrl: avatarUrl
                    });
                    
                    if (updateResponse.success) {
                        // æ›´æ–°æœ¬åœ°ç”¨æˆ·ä¿¡æ¯
                        currentUser.avatarUrl = avatarUrl;
                        
                        // æ›´æ–°æ˜¾ç¤º
                        const avatarElement = document.getElementById('user-avatar');
                        const avatarPreview = document.getElementById('avatar-preview');
                        
                        avatarElement.style.backgroundImage = `url(${avatarUrl})`;
                        avatarElement.style.backgroundSize = 'cover';
                        avatarElement.style.backgroundPosition = 'center';
                        avatarElement.textContent = '';
                        
                        if (avatarPreview) {
                            avatarPreview.style.backgroundImage = `url(${avatarUrl})`;
                            avatarPreview.style.backgroundSize = 'cover';
                            avatarPreview.style.backgroundPosition = 'center';
                            avatarPreview.textContent = '';
                        }
                        
                        alert('å¤´åƒä¿å­˜æˆåŠŸï¼');
                    } else {
                        alert('å¤´åƒä¿å­˜å¤±è´¥ï¼š' + updateResponse.message);
                    }
                } else {
                    alert('å¤´åƒä¸Šä¼ å¤±è´¥ï¼š' + response.message);
                }
            } catch (error) {
                console.error('å¤´åƒä¸Šä¼ å‡ºé”™:', error);
                alert('å¤´åƒä¸Šä¼ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // ä¿®æ”¹å¯†ç 
        async function changePassword(event) {
            event.preventDefault();
            
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (newPassword !== confirmPassword) {
                alert('ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç ä¸ä¸€è‡´');
                return;
            }
            
            try {
                const response = await userAPI.changePassword({
                    oldPassword: currentPassword,
                    newPassword: newPassword,
                    confirmPassword: confirmPassword
                });
                
                if (response.success) {
                    alert('å¯†ç ä¿®æ”¹æˆåŠŸï¼');
                    document.getElementById('password-form').reset();
                } else {
                    alert('å¯†ç ä¿®æ”¹å¤±è´¥ï¼š' + response.message);
                }
            } catch (error) {
                console.error('ä¿®æ”¹å¯†ç å‡ºé”™:', error);
                alert('å¯†ç ä¿®æ”¹å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // åŠ è½½æˆ‘çš„å‘å¸ƒ
        async function loadMyPosts() {
            try {
                // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
                if (!currentUser) {
                    console.log('ç”¨æˆ·æœªç™»å½•ï¼Œæ— æ³•åŠ è½½å¸–å­');
                    userPosts = [];
                    displayMyPosts([]);
                    return;
                }
                
                const response = await postAPI.getMy(0, 20);
                if (response.success && response.data) {
                    // å¤„ç†åˆ†é¡µæ•°æ®ç»“æ„
                    const posts = response.data.content || response.data.posts || [];
                    userPosts = posts;
                    displayMyPosts(userPosts);
                } else {
                    console.log('æ²¡æœ‰æ‰¾åˆ°å¸–å­æ•°æ®');
                    userPosts = [];
                    displayMyPosts([]);
                }
            } catch (error) {
                console.error('åŠ è½½æˆ‘çš„å¸–å­å¤±è´¥:', error);
                if (error.message && error.message.includes('401')) {
                    console.log('ç”¨æˆ·æœªè®¤è¯ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢');
                    window.location.href = 'login.html';
                } else {
                    userPosts = [];
                    displayMyPosts([]);
                }
            }
        }
        
        // åˆ é™¤å¸–å­
        async function deletePost(postId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡å¸–å­å—ï¼Ÿ')) return;
            
            const response = await postAPI.delete(postId);
            if (response.success) {
                loadMyPosts(); // é‡æ–°åŠ è½½åˆ—è¡¨
                updateUserStats(); // æ›´æ–°ç»Ÿè®¡æ•°æ®
            }
        }

        // æ˜¾ç¤ºæˆ‘çš„å‘å¸ƒ
        function displayMyPosts(posts) {
            const listElement = document.getElementById('my-posts-list');
            
            listElement.innerHTML = posts.map(post => `
                <div class="post-item">
                    <div class="post-item-header">
                        <a href="post-detail.html?id=${post.id}" class="post-item-title">${escapeHtml(post.title)}</a>
                        <div class="post-item-actions">
                            <a href="create-post.html?edit=${post.id}" class="action-link">ç¼–è¾‘</a>
                            <a href="#" class="action-link" onclick="deletePost(${post.id})">åˆ é™¤</a>
                        </div>
                    </div>
                    <div class="post-item-meta">
                        <span>å‘å¸ƒæ—¶é—´ï¼š${formatDate(post.createdAt)}</span>
                        <span>åˆ†ç±»ï¼š${escapeHtml(post.categoryName || 'æœªåˆ†ç±»')}</span>
                        <span>é˜…è¯»ï¼š${post.viewCount || 0}</span>
                        <span>çŠ¶æ€ï¼š${getPostStatusText(post.status)}</span>
                    </div>
                </div>
            `).join('');
        }

        // åŠ è½½æˆ‘çš„æ”¶è—
        async function loadMyCollections() {
            try {
                // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
                if (!currentUser) {
                    console.log('ç”¨æˆ·æœªç™»å½•ï¼Œæ— æ³•åŠ è½½æ”¶è—');
                    document.getElementById('my-collections-empty').style.display = 'block';
                    return;
                }
                
                const response = await userAPI.getCollections(0, 20);
                if (response.success && response.data && response.data.content) {
                    const collections = response.data.content;
                    if (collections.length > 0) {
                        displayMyCollections(collections);
                        document.getElementById('my-collections-empty').style.display = 'none';
                    } else {
                        document.getElementById('my-collections-empty').style.display = 'block';
                    }
                } else {
                    console.log('æ²¡æœ‰æ‰¾åˆ°æ”¶è—æ•°æ®');
                    document.getElementById('my-collections-empty').style.display = 'block';
                }
            } catch (error) {
                console.error('åŠ è½½æˆ‘çš„æ”¶è—å¤±è´¥:', error);
                if (error.message && error.message.includes('401')) {
                    console.log('ç”¨æˆ·æœªè®¤è¯ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢');
                    window.location.href = 'login.html';
                } else {
                    document.getElementById('my-collections-empty').style.display = 'block';
                }
            }
        }

        // æ˜¾ç¤ºæˆ‘çš„æ”¶è—
        function displayMyCollections(collections) {
            const listElement = document.getElementById('my-collections-list');
            
            listElement.innerHTML = collections.map(post => `
                <div class="post-item">
                    <div class="post-item-header">
                        <a href="post-detail.html?id=${post.id}" class="post-item-title">${escapeHtml(post.title)}</a>
                        <div class="post-item-actions">
                            <a href="#" class="action-link" onclick="removeFromCollection(${post.id})">å–æ¶ˆæ”¶è—</a>
                        </div>
                    </div>
                    <div class="post-item-meta">
                        <span>æ”¶è—æ—¶é—´ï¼š${formatDate(post.createdAt)}</span>
                        <span>åˆ†ç±»ï¼š${escapeHtml(post.categoryName || 'æœªåˆ†ç±»')}</span>
                        <span>é˜…è¯»ï¼š${post.viewCount || 0}</span>
                    </div>
                </div>
            `).join('');
        }
        
        // å–æ¶ˆæ”¶è—
        async function removeFromCollection(postId) {
            if (!confirm('ç¡®å®šè¦å–æ¶ˆæ”¶è—è¿™ç¯‡å¸–å­å—ï¼Ÿ')) {
                return;
            }
            
            try {
                const response = await postAPI.toggleFavorite(postId);
                if (response.success) {
                    // é‡æ–°åŠ è½½æ”¶è—åˆ—è¡¨
                    loadMyCollections();
                    // æ›´æ–°æ”¶è—æ•°é‡
                    updateUserStats();
                } else {
                    alert('å–æ¶ˆæ”¶è—å¤±è´¥: ' + (response.message || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                console.error('å–æ¶ˆæ”¶è—å¤±è´¥:', error);
                alert('å–æ¶ˆæ”¶è—å¤±è´¥: ' + error.message);
            }
        }

        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                localStorage.removeItem('token');
                localStorage.removeItem('username');
                localStorage.removeItem('userId');
                window.location.href = 'login.html';
            }
        }

        // ç¡®è®¤æ³¨é”€è´¦æˆ·
        function confirmDeleteAccount() {
            if (confirm('è­¦å‘Šï¼šæ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤æ‚¨çš„è´¦æˆ·å’Œæ‰€æœ‰æ•°æ®ï¼Œä¸”ä¸å¯æ¢å¤ã€‚ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
                if (confirm('è¯·å†æ¬¡ç¡®è®¤ï¼šæ‚¨çœŸçš„è¦æ³¨é”€è´¦æˆ·å—ï¼Ÿ')) {
                    alert('è´¦æˆ·æ³¨é”€åŠŸèƒ½å¼€å‘ä¸­ï¼Œå¦‚éœ€æ³¨é”€è¯·è”ç³»å®¢æœã€‚');
                }
            }
        }

        // æ˜¾ç¤ºå†…å®¹åŒºåŸŸ
        function showContent(section) {
            // éšè—æ‰€æœ‰å†…å®¹åŒºåŸŸ
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(s => s.style.display = 'none');
            
            // ç§»é™¤æ‰€æœ‰å¯¼èˆªé¡¹çš„activeç±»
            const navLinks = document.querySelectorAll('.nav-menu a');
            navLinks.forEach(link => link.classList.remove('active'));
            
            // æ˜¾ç¤ºé€‰ä¸­çš„å†…å®¹åŒºåŸŸ
            document.getElementById(section + '-content').style.display = 'block';
            
            // æ·»åŠ activeç±»åˆ°å½“å‰å¯¼èˆªé¡¹
            event.target.classList.add('active');
            
            // æ ¹æ®é€‰æ‹©çš„å†…å®¹åŠ è½½ç›¸åº”æ•°æ®
            switch(section) {
                case 'posts':
                    loadMyPosts();
                    break;
                case 'collections':
                    loadMyCollections();
                    break;
            }
        }

        // å·¥å…·å‡½æ•°
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN');
        }

        function getPostStatusText(status) {
            const statusMap = {
                'PUBLISHED': 'å·²å‘å¸ƒ',
                'DRAFT': 'è‰ç¨¿',
                'PENDING': 'å¾…å®¡æ ¸',
                'REJECTED': 'å·²æ‹’ç»'
            };
            return statusMap[status] || 'æœªçŸ¥';
        }
    </script>
</body>
</html>